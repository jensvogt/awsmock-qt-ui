name: Build Qt Project (Ubuntu)

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Checkout
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4
        with:
          # Fetch submodules if your project uses them
          submodules: true

      # New Step: Install libcurl-dev and other system dependencies
      - name: üì¶ Install System Dependencies (libcurl-dev)
        run: |
          sudo apt-get update
          sudo apt-get install -y libcurl4-openssl-dev

      # Install Qt using the setup-qt action
      - name: Install Qt
        uses: jurplel/install-qt-action@v4
        with:
          # Specify the Qt version to use, e.g., 6.6.1
          version: '6.10.1'
          # The modules to install, separated by commas.
          modules: 'qtbase,qttools,qtsvg,qtnetwork,qtcharts'
          # Optional: automatically install Linux dependencies
          install-deps: true

      # Configure the project with CMake
      - name: Configure CMake
        # Using 'shell: bash' ensures the environment variables set by setup-qt are available.
        shell: bash
        run: |
          # Create a build directory
          mkdir build
          cd build
          # Run cmake with the necessary build type and generator
          cmake .. -DCMAKE_BUILD_TYPE=Release -G "Unix Makefiles"

      # Build the application
      - name: Build Application
        shell: bash
        run: |
          cd build
          # Use --config Release if you were using Visual Studio Generator, but for Unix Makefiles, it's often 'make'
          cmake --build . --target all -j $(nproc)

      # Optional: Package or Upload the artifact (e.g., the executable)
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: qt-app-executable
          path: build/awsmock-qt-ui # Replace 'your-app-name' with the actual executable name
